2003-01-05  Luis Oliveira  <luis@handhelds.org>

	* First steps towards libgpeeventdb.
	* event-db.c (event_db_refresh): New function.
	  (event_db_stop): Free event lists.
	* globals.h event-db.h: Moved some defines from globals.h to
	event-db.h

2003-01-05  Philip Blundell  <philb@gnu.org>

	* familiar/control1 (Version): Version 0.31 released.

2003-01-05  Philip Blundell  <philb@gnu.org>

	* event-db.c (event_db_clone): Add missing memcpy, duh.

2003-01-05  Philip Blundell  <philb@gnu.org>

	* familiar/control1 (Version): Version 0.30 released.

2003-01-05  Philip Blundell  <philb@gnu.org>

	* month_view.c (button_press): Ignore clicks other than button 1.
	(month_view): Select for release events.

	* xsettings.c (notify_func): Only act on CHANGED or NEW messages.

2003-01-04  Philip Blundell  <philb@gnu.org>

	* event-db.h (event_db__alloc_event): New.
	(event_db__alloc_recur): Likewise.
	(event_db__free_event): Likewise.
	(event_db__free_recur): Likewise.
	(EVENT_DB_USE_MEMCHUNK): Likewise.  Default on.
	* event-db.c (event_db_start): Create new GMemChunks.
	(load_callback): Use above macros.
	(event_db_clone): Likewise.
	(event_db_new): Likewise.
	(event_db_destroy): Likewise.
	(event_db_destroy_clone): Likewise.
	(event_db_get_recurrence): Likewise.
	* old-db.c (load_callback0): Likewise.
	
2003-01-04  Philip Blundell  <philb@gnu.org>

	* Version 0.29 released.
	
2003-01-04  Philip Blundell  <philb@gnu.org>

	* main.c (button_toggled): Only act when button is active.

	* event-db.c (event_db_clone): New.
	(event_db_list_for_period_internal): Use it.  Reformat.
	Reorganise handling of max-events.
	(get_ev_from_uid): Rename to ...
	(event_db_find_by_uid): ... this.  All callers updated.
	* event-db.h (event_db_clone): New prototype.
	(get_ev_from_uid): Rename to event_db_find_by_uid.

	* day_popup.c (day_popup): Mark string for translation.
	
2003-01-03  Joseph J. McCarthy  <mccarthy@engrng.pitt.edu>

        * event-db.h : add FLAGS for RECUR and CLONE 
	* day_popup.c (selection_made & day_popup): attach uid to row so 
	we can grab the uncloned event_t (also fix small warning on 
	SIGNAL_FUNC)
	* day_view.c (selection_made & day_view_update): attach uid to row so 
	we can grab the uncloned event_t
	* event-db.c (event_db_list_for_period_internal): losts of changes 
	here and elsewhere to add cloned records; highlights -> new 
	routines get_ev_from_uid, event_db_destroy_clone; remove clones
	when doing event_db_list_destroy, *will now be able to get event-list
	IN ORDER, so we can implement next_alarm!*
	* event-ui.c (edit_event): small warning fix, and silly fix for recur
	toggle buttons
	* future_view.c (selection_made & future_view_update): attach uid to 
	row so we can grab the uncloned event_t (also warning fix)
	 * main.c : change default font slightly	
	
2003-01-01  Philip Blundell  <philb@gnu.org>

	* Version 0.28 released.

2003-01-01  Philip Blundell  <philb@gnu.org>

	* event-ui.c (build_edit_event_window): Tasks are not yet properly
	implemented; don't offer them on the menu.

2003-01-01  Philip Blundell  <philb@gnu.org>

	* event-ui.c (build_edit_event_window): Set week-starts-monday
	flag on newly created GtkDateCombo widgets.
	(build_edit_event_window): Set default size for window.

	* xsettings.c (gpe_calendar_start_xsettings): Use gpe_error_box.
	(watch_func): Reformat decl.
	(notify_func): Likewise.  Make key names case insensitive.  Add
	GPE/week-starts-monday as synonym for old key under GPE/Calendar.
	(KEY_BASE): Set to "GPE/".

	* gpe-calendar.desktop (SingleInstance): Set to true.

	* main.c (my_icons): Add close.
	(main): Use gpe_set_window_icon.  Add more verbose tooltips.

	* day_popup.c (day_popup): Replace cancel pixmap with close.  Pack
	buttons with no padding.  Put a frame around the window contents.
	(destroy_popup): Reformat.
	(close_window): Likewise.
	(day_clicked): Likewise.
	(selection_made): Likewise.
	
	* event-ui.c (new_event): Set window title.
	(edit_event): Likewise.
	(build_edit_event_window): Set icon for window.

	* main.c (main): Remove call to event_ui_init.

2002-12-19  Philip Blundell  <philb@gnu.org>

	* Version 0.27 released.

2002-12-15  Luis Oliveira  <luis@handhelds.org>

	* po/pt_PT.po: Updated translation.

2002-12-15  Philip Blundell  <philb@gnu.org>

	* po/pt_PT.po: Set character set to iso-8859-15.

2002-10-31  Luis Oliveira  <luis@handhelds.org>

       * event-db.c (event_db_destroy): Fix memory leak.

2002-12-07  Philip Blundell  <philb@gnu.org>

	* month_view.c (draw_expose_event): Remove unused variable.
	* event-db.c (insert_values): Remove spurious token-paste.

2002-12-06  Philip Blundell  <philb@gnu.org>

	* gpe-calendar.desktop: New file.
	* Makefile (install): Install it.
	Patch from Matthew Allum <breakfast@10.am>

2002-11-30  Philip Blundell  <philb@gnu.org>

	* Version 0.26 released.

2002-11-30  Philip Blundell  <philb@gnu.org>

	* day_view.c (day_view_update): Set scroll position to current
	hour.
	(scroll_adjustment): New global.
	(day_view): Initialise it.

	* event-ui.c (edit_event): Explicitly set state of more widgets.
	(new_event): Likewise.

	* event-ui.c (build_edit_event_window): Use GtkTextView for
	description under GTK 2.
	(click_ok): Likewise.
	(new_event): Likewise.
	(edit_event): Likewise.

	* Makefile (GTKCFLAGS): Remove -DGTK_ENABLE_BROKEN.

	* event-ui.c (build_edit_event_window): Adjust GtkSimpleMenu
	signal naming.

	* main.c (main): Call event_ui_init.
	* event-ui.h (event_ui_init): Add prototype.
	* event-ui.c (event_ui_init): New function.
	(build_edit_event_window): Renamed from edit_event_window.
	(edit_event_window): New function; wrap the above.
	(edit_finished): New function.
	(click_delete): Call it.
	(click_ok): Likewise.
	(click_cancel): Likewise.

2002-11-29  Philip Blundell  <philb@gnu.org>

	* day_view.c (selection_made): Set viewtime when a row is single
	clicked.

2002-10-17  Philip Blundell  <philb@gnu.org>

	* Version 0.25 released.

2002-10-17  Philip Blundell  <philb@gnu.org>

	* main.c (main): Call gpe_calendar_start_xsettings.
	(day_view_combined_times): Define.
	* xsettings.c: New file.
	* globals.h (day_view_combined_times): Declare.
	* day_view.c (day_view_combined_times): Don't define.
	* Makefile (MEMBERS): Add xsettings.
	* Makefile (LDFLAGS): Add Xsettings libraries.
	* Makefile (CFLAGS): Add Xsettings include paths.
	
2002-10-14  Joseph J. McCarthy  <mccarthy@engrng.pitt.edu>

        * event-ui.c (schedule_alarm): add DISPLAY to script 

2002-10-13  Philip Blundell  <philb@gnu.org>

	* week_view.c (draw_expose_event): Format time correctly.
	(week_view_update): Likewise.

2002-10-12  Philip Blundell  <philb@gnu.org>

	* week_view.c (draw_expose_event): Only draw black separator when
	appropriate to do so.
	(week_view_update): Put untimed events at start of list.
	Calculate required height appropriately for Pango.

	* main.c (main): Put all views inside a GtkNotebook.
	(new_view): Select the appropriate page.

2002-10-12  Philip Blundell  <philb@gnu.org>

	* Makefile (GTK2): Default is yes.

	* main.c (main): Fix warnings.

	* week_view.c: Switch back to drawing area implementation.

2002-10-07  Philip Blundell  <philb@gnu.org>

	* event-ui.c (edit_event_window): Fix memory leak.

2002-10-06  Philip Blundell  <philb@gnu.org>

	* Version 0.23 released.

2002-10-06  Philip Blundell  <philb@gnu.org>

	* Makefile: Add support for GTK 2.
	* day_view.c (day_view_update): Likewise.
	* future_view.c (future_view_update): Likewise.
	* month_view.c (draw_expose_event): Likewise.
	* main.c (main): Likewise.
	* familiar/control1: New file.

	* Makefile (DEBUG): Default off.

	* month_view.c (button_press): Reject clicks outside valid area.
	[Bug #130]
	(resize_table): Calculate height on the basis of 7 rows.  
	[Bug #133]

	* main.c (main): Use radio buttons for view selection, based on
	patch from pigeon@pigeond.net.
	(set_week_view, set_month_view, set_year_view, set_future_view): Deleted.

2002-10-04  Joseph J. McCarthy  <mccarthy@engrng.pitt.edu>

	* event-db.c (event_db_list_for_period_internal: erase
	the "max &&" and "/*skip already finished events */" 
	parts got cut	
	* future-view.c: change to use list_for_future()

2002-09-29  Philip Blundell  <philb@gnu.org>

	* day_view.c (format_event): Handle untimed events.  Elide end
	time if duration is zero.
	(day_view_update): Handle untimed events appropriately.

	* event-db.c (event_db_new): Zero newly allocated structure.

2002-09-29  Philip Blundell  <philb@gnu.org>

	* event-db.c (event_db_list_for_period_internal): New parameters
	"max", "untimed_significant".
	(event_db_list_for_period): Update call to above function.
	(event_db_untimed_list_for_period): Likewise.
	(event_db_list_for_future): New.

	* event-db.h (event_db_list_for_future): New prototype.
	
2002-09-29  Philip Blundell  <philb@gnu.org>

	* event-db.h (recur_t): New, broken out from event_t.
	(event_t): Member "recur" is now a pointer.
	(event_db_get_recurrence): New prototype.
	* event-db.c (events): Separate back into recurring_events and
	one_shot_events.
	(event_db_add_internal): Use appropriate list.
	(event_db_remove_internal): Likewise.
	(load_data_callback): Allocate ev->recur when required.
	(load_callback): Free recurrence struct if it was allocated by
	mistake.
	(event_db_list_for_period_internal): Use separate one-shot and
	recurring lists.  Cope with ev->recur as a pointer.
	(event_db_write): Only write recurrence tags for recurring events.
	Cope with ev->recur as a pointer.
	(event_db_destroy): Free recurrence struct if it exists.
	(event_db_get_recurrence): New.
	* day_view.c (day_view_update): Fix formatting.  Just test
	ev->recur, not ev->recur.type.
	* old-db.c (load_callback0): No need to set recurrence type.
	* event-ui.c (click_ok): Allocate or dispose of recurrence struct
	as appropriate.  Fix formatting.  Use "for" loop for day-related
	tests.
	(edit_event): Fix formatting.  Expect ev->recur as a pointer.  Use
	"for" loop for day masking.

2002-09-26  Joseph J. McCarthy  <mccarthy@engrng.pitt.edu>

	* Makefile: drop libgpe dependencies	
	* event-ui.h: change to atd for alarms	
	* event-ui.c: change to atd for alarms	
	* day-view.c: add pixmaps for recurring and alarms	
	* year-view.c: delete unused variable	

	* Version 0.22 released.

2002-09-09  Joseph J. McCarthy  <mccarthy@engrng.pitt.edu>

	* month-view.c: fix daylight savings glitch
	
	* year-view.c: same	

2002-09-08  Philip Blundell  <philb@gnu.org>

	* event-ui.c (struct edit_state): Add taskdate, taskspin,
	optionmenutype, optionmenutask.
	(set_notebook_page): Operate on GtkSimpleMenu.
	(edit_event_window): Use GtkSimpleMenu for type selection.  Add
	preliminary support for "tasks".

2002-09-06  Joseph J. McCarthy  <mccarthy@engrng.pitt.edu>

	* event-ui.c: add rtcd support for alarms and re-show alarm notepage
	WE NEED TO FIX THIS PRIOR TO OUR NEXT RELEASE SINCE THE RTCD IS A HACK!
	
	* event-ui.h: alarm stuff	

2002-09-05  Philip Blundell  <philb@gnu.org>

	* main.c (main): Reinstate yearfont, datefont.
	* globals.h: Likewise.
	* year_view.c: Roll back to non-GtkCalendar version.

	* day_popup.c (day_popup): Call mktime to calculate day of week
	correctly.

2002-09-04  Philip Blundell  <philb@gnu.org>

	* Version 0.20 released.

2002-09-02  Philip Blundell  <philb@gnu.org>

	* event-ui.c (new_event): Fix calculation of end time when
	wrapping from one day to the next.
	(struct edit_state): Add notebooktype, page.
	(click_ok): Distinguish appointments and reminders.
	(set_notebook_page): Set s->page.
	(edit_event_window): Pass edit_state as argument to above
	function.
	* main.c (new_appointment): Use viewtime, not current time.

2002-09-01  Philip Blundell  <philb@gnu.org>

	* event-ui.c (struct edit_state): Delete alldaybutton.  Add
	reminderdate, remindertime, remindertimebutton.
	(recalculate_sensitivities): Replace alldaybutton with
	remindertimebutton.
	(set_notebook_page): New.
	(edit_event_window): Distinguish between "appointments" and
	"reminders".

2002-08-31  Philip Blundell  <philb@gnu.org>

	* event-ui.c (edit_event_window): Put event box in a
	GtkScrolledWindow.

2002-08-31  Philip Blundell  <philb@gnu.org>

	* month_view.c (c_old): Make static.
	(button_press): Fix formatting.
	(struct render_ctl): Add "today".
	(draw_expose_event): Draw red border when c->today==TRUE.
	(month_view_update): Set c->today appropriately.

2002-08-31  Philip Blundell  <philb@gnu.org>

	* month_view.c (TOTAL_DAYS): New macro.
	(draw_expose_event): Use it.
	(month_view_update): Likewise.
	(rc): Use TOTAL_DAYS as array size.

2002-08-31  Philip Blundell  <philb@gnu.org>

	* event-db.c (event_db_alloc_details): Add refcount.
	(event_db_forget_details): Likewise.
	(event_db_get_details): Likewise.
	(event_db_write): Use event_db_get_details and
	event_db_forget_details.  Reduce size of string buffers.  Use
	sizeof where appropriate.  Take "sequence" and "modified" from
	details struct, not event_t.
	* event-db.h (event_details_s): Add ref, sequence, modified.
	(event_s): Remove sequence, modified.
	* event-ui.c (click_ok): Call event_db_forget_details.  Use
	ev_d->sequence not ev->sequence.

2002-08-30  Philip Blundell  <philb@gnu.org>

	* event-db.h (event_s): Add "sequence".
	* event-db.c (event_db_write): Write out SEQUENCE tag.
	(load_data_callback): Read it back in again.

	* event-ui.c (click_ok): Bump sequence number on existing events.

2002-08-30  Philip Blundell  <philb@gnu.org>

	* event_db.h (struct calendar_time_s): New struct.

2002-08-30  Philip Blundell  <philb@gnu.org>

	* event-ui.c (struct edit_state): Delete "old_alarm".
	(click_ok): Replace test of s->old_alarm with direct inspection of
	ev->flags.
	(edit_event): Don't set s->old_alarm;
	(new_event): Likewise.
	(recalculate_sensitivities): Fix formatting.

2002-08-30  Philip Blundell  <philb@gnu.org>

	* event-ui.c (click_ok): Reuse old event structure when modifying
	an existing event.
	* event-db.c (event_db_write): New function.
	(event_db_flush): Likewise.
	(event_db_add): Use event_db_write.
	(insert_values): Expect err as char**.
	* event-db.h (event_db_flush): New prototype.

2002-08-30  Philip Blundell  <philb@gnu.org>

	* event-db.h (FLAG_TENTATIVE): New.
	(calendar_time_t): New type.
	(event_t): Delete "confirmed".  Change type of "start" to 
	calendar_time_t.

	* event-ui.c (click_delete): Test for flags & FLAG_ALARM.
	(edit_event): Likewise.
	(click_ok): Likewise.  Set FLAG_ALARM bit appropriately.

2002-08-29  Philip Blundell  <philb@gnu.org>

	* event-db.c (parse_date): Don't dereference date_only if NULL.
	(load_data_callback): Pass "date_only" as NULL to above function
	when not interested in that information.

	* globals.h (timefont, datefont, yearfont, DO_RECURRENCE): Delete
	obsolete cruft.

2002-08-25  Joseph J. McCarthy  <mccarthy@engrng.pitt.edu>

	* old-db.c: fix for when no db exists.
	
	* event-db.c: include recurrence and fix deleting.
	
	* event-db.h: small schema change for recurrence.
	
	* event-ui.c: include recurrence.
	
	* globals.h: include recurrence bit thingies.
	
2002-08-25  Joseph J. McCarthy  <mccarthy@engrng.pitt.edu>

	* old-db.c: write new schema version to db after update.
	
	* event-db.c: Use new database schema versioning.
	
2002-08-26  Philip Blundell  <philb@gnu.org>

	* event-db.c (parse_date): New function.
	(load_data_callback): Use it.

2002-08-25  Philip Blundell  <philb@gnu.org>

	* day_popup.c (day_popup): Return GtkWidget*.
	* day_popup.h (day_popup): Adjust prototype to match.

	* old-db.c: New file.
	* Makefile (MEMBERS): Add old-db.

	* event-db.c: Use new database schema.
	* event-db.h (FLAG_ALARM): New.

2002-08-23  Philip Blundell  <philb@gnu.org>

	* Makefile (DEBUG): Default off.
	* main.c (main): Remove historical font-loading cruft.

2002-08-22  Joseph J. McCarthy  <mccarthy@engrng.pitt.edu>

	* day_view.c (day_view_update, update_hooks_callback): move set_time.
	* week_view.c (week_view_update, update_hooks_callback): Likewise.	
	* month_view.c (month__view_update, update_hooks_callback): Likewise.
	* year_view.c (year_view_update, update_hooks_callback): Likewise.
	
2002-08-05  Colin Marquardt  <colin@marquardt-home.de>

	* po/Makefile (translation-package): Get control and postinst from
	control.translation and postinst.translation.

	* Makefile (translation-package): New target to automatically
	make translation packages. Just calls the same target in po/Makefile.

	* po/Makefile (translation-package): New target to automatically
	make translation packages. This actually does all the work.

2002-07-31  Philip Blundell  <philb@gnu.org>

	* main.c: Remove useless include of gdk_imlib.h

2002-07-29  Colin Marquardt  <colin@marquardt-home.de>

	* gpe-calendar.menu: Give full path for the icon. Move to section
	PIM (to conform to http://familiar.handhelds.org/policy/menu.html)

2002-07-17  Philip Blundell  <pb@nexus.co.uk>

	* Version 0.10 released

2002-07-13  Philip Blundell  <philb@gnu.org>

	* main.c (main): Remove call to what_init.

2002-07-09  Philip Blundell  <philb@gnu.org>

	* Makefile (gpe-calendar): Link with libgpewidget before libgtk.

2002-06-22  Philip Blundell  <philb@gnu.org>

	* main.c (main): Set icon for window manager.

	* event-ui.c (click_ok): Correct DST related lossage.

	* event-db.c (event_db_alloc_details): Pass correct size to
	memset.

	* Version 0.09 released.

2002-06-21  Joseph J. McCarthy  <mccarthy@engrng.pitt.edu>

	* month_view.c (button_press): Use global pop_window pointers so it
	is easier to manipulate the pop-up from a few different routines
	(this will help with the soon-to-be-worked-on new year-view as well).

	* globals.h : Add a new global for the pop-up windows (so they are
	easier to kill).

	* main.c : Add a new global for the pop-up windows (so they are
	easier to kill).

	* day_popup.c (destroy_popup): Set global pop_window pointer to NULL
	when window is killed

	* Version 0.08 released.

2002-06-21  Philip Blundell  <pb@debian.org>

	* month_view.c (draw_expose_event): Draw days with events as
	gray60 background and white text.  Unref newly created GCs when
	done with them.

	* event-ui.c (click_ok): Disallow end time earlier than start time.

	* familiar/control (Depends): Require libgpewidget 0.08.  Remove
	explicit dependency on gdk-pixbuf2.

	* Version 0.08 released.

2002-06-20  Philip Blundell  <pb@debian.org>

	* main.c (main): Call what_init.

2002-06-18  Philip Blundell  <pb@debian.org>

	* day_popup.c (day_popup): Realize widget before using its style.
	Add missing include.
	* event-ui.c (edit_event_window): Likewise.
	* main.c: Add missing include.

2002-06-16  Philip Blundell  <pb@debian.org>

	* main.c (my_pix): Add "cancel".
	* day_popup.c (day_popup): Use gpe_find_pixmap.

2002-06-15  Philip Blundell  <pb@debian.org>

	* Makefile: Don't link with gdk-imlib.
	(MEMBERS): Remove about.
	* about.c: Obsolete, deleted.
	

